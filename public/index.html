<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Two-Way Radio Helicopter</title>
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" id="num0" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_1.png" id="num1" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_2.png" id="num2" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_3.png" id="num3" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_4.png" id="num4" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_5.png" id="num5" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_6.png" id="num6" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_7.png" id="num7" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_8.png" id="num8" style="display: none">
	<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_9.png" id="num9" style="display: none">
	<audio id="voiceAudio" onended="stopSound()" crossOrigin="anonymous"></audio>
	<audio src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/helicopter.wav" id="audio1" crossOrigin="anonymous"></audio>
	<audio src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/helicopter2.wav" id="audio2" crossOrigin="anonymous" style="display: none"></audio>
	<audio src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/radio_static.wav" id="audio3" crossOrigin="anonymous" style="display: none"></audio>
	<audio src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/radio_click_on.mp3" id="audio4" crossOrigin="anonymous" style="display: none"></audio>
	<audio src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/click_on.mp3" id="audio5" crossOrigin="anonymous" style="display: none"></audio>
	<style>
		.main-container{
			width: 750px; /* 1000px*/
			height: 1050px; /* 1587px */
			background-image: url("https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/bkg.png");
			margin: 10px;
			padding-left:2.5%;
			padding-right: 2.5%;
		}
		.top-container{
			position: relative;
			/*text-align: center;*/
			padding-left: 25%;
			padding-top: 7%;
			padding-bottom: 3%;
        }



		.right-container{

		}
		.slider-container{
			position: relative;
			float: left;
			width: 120px;  /* 161px */
			height: 400px;  /* 540px*/
			background-image: url(https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_control.png);
			background-size: contain;

			margin-left: 3%;
			margin-top: 4%;
			text-align: center;
		}

		/*.slider{
			position: absolute;
			-webkit-appearance: slider-vertical;
			width: 20px;
			height: 37%;
			background-image: url(/slider_control_knob.png);
			top: 17%;
			left: 42%;
		}*/

		input[type='range']::-webkit-slider-thumb{
			-webkit-appearance: none;
			top: 50%;
			left: 50%;
			margin-right: -75%;
			transform: translate(200px, -50%);
			background-image: url(https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_control_knob.png);
			background-size: cover;
			/*margin: 0;*/
			height: 35px;
			width: 60px;
			-webkit-transform:rotate(90deg);
		}

		input[type='range']::-webkit-slider-runnable-track{
			-webkit-appearance: none;
			border: none;
			height: 37%;
			width: 20px;
			border-radius: 3px;
			background: none;
			margin-top: auto;
			margin-bottom: auto;
			justify-content: center;
			
		}

		input[type='range']:focus{
			outline: none;
		}

		input[type='range']{
			position: absolute;
			-webkit-appearance: none;
			background-color: #00000000;
			left: -40%;
			top: 32%;
			height: 40px;
			width: 160%;
			justify-content: center;
			-webkit-transform:rotate(-90deg);
		}

		img[class="light-on"]{
			position: absolute;
			left: 20.3%;
			top: 59%;
			
		}

		img[class="light-off"]{
			position: absolute;
			left: 20.3%;
			top: 63.5%;
			
		}
		

		button[class="onButton"]{
			position: absolute;
			width: 70%;
			height: 9.5%;
			left: 15%;
			top: 72%;
			background-color: #00000000;
			outline: none;
			border: none;
		}

		button[class="onButton"]:active{
			background-color: #00000022;
		}

		p[class="slider-label"]{
			position: absolute;
			font-family: "Myriad Pro", Arial ;
			color: white;
			text-align: center;
			font-size: 12pt;
			font-weight: bold;
			margin: 10%;
			/*top: -2%;*/
		}

		img[class="slider-digit-two"]{
			position: absolute;
			top: 85.5%;
			left: 23%;
		}

		img[class="slider-digit-one"]{
			position: absolute;
			top: 85.5%;
			left: 53%;
		}

		.button-container{
			/*position: relative;*/
			/*margin-top: 30px;
			padding-left: 200px;*/
		}

		button{
			background-color: black;
			border: none;
			color: white;
			width: 150px;
			height: 77px;
			margin-left: 4%;
			margin-top: 4%;
			font-family: arial;
			cursor: pointer;
			font-size: 12pt;
		}

		

		
		.input-file{
			/*visibility: hidden;
			outline: none;*/
			width: 0.1px;
			height: 0.1px;
			opacity: 0;
			overflow: hidden;
			position: absolute;
			z-index: -1;
		}

		.input-file + label{
			position: absolute;
			background-color: black;
			border: none;
			color: white;
			width: 150px;
			height: 20px;
			margin-left: 4%;
			margin-top: 0%;
			font-family: arial;
			cursor: point;
			padding-top: 25px;
			padding-bottom: 25px;
			font-size: 12pt;
			text-align: center;
		}

		.inputfile:focus + label,
		.inputfile + label:hover {
		    background-color: #;
		}

		.input-file + label:active{
			background-color: #00000088;
		}

		textarea{
        	width: 200px;
			/*height: 30px;*/
			padding: 27px 0;
			font-family: sans-serif;
			margin-left: 0%;
			
			font-size: 9pt;
			font-weight: bold;
        }

		

		/*.play{
			background-color: #00ff00ff;
		}

		.stop{
			background-color: #ff0000ff;
		}*/
		.volume-controls{
			clear: both;
			border-style: double;
			border-width: 5px;
		}

		a{
			background-image: linear-gradient(#00ff00ff, #00ff11ff);
			border-radius: 3px;
			border-style: groove;
			color: white;
			text-decoration: none;
			text-transform: uppercase;
			font-family: helvetica;
			padding: 300px, 300px;
			margin: 100px;
		}

		.progress-bar{
			position: relative;
			width: 650px;
			height: 10px;
			background-color: #111;
			border-radius: 20px;
			margin-left:60px;
			margin-top: 18px;
			color: white;

		}

		.progress-bar::before{
			content: attr(data-label);
			font-family: sans-serif;
			font-size: 6pt;
			display: flex;
			align-items: center;
			position: absolute;
			color: black;
			left: .1em;
			top: 0px;
			bottom: 0px;
			width: calc(var(--width, 0) * 1%);
			min-width: 2rem;
			max-width: calc(100% - 1.2em);
			background-color: #76d3f1ff;
			border-radius: 18px;
			padding: .5em;
			box-shadow: 1px 1px 10px 2px #76d3f1ff;
		}

		
	</style>
</head>
<body onload="initializeData()">
	
	<div class="main-container">
		<div class="top-container">
				<textarea id="fileTextArea" rows="1">SELECT FILE TO UPLOAD</textarea>
			    <input type="file" accept="audio/*" id="file1" class="input-file" >
			   <label for="file1">UPLOAD</label>
			   	
		</div>
		<div class="right-container">
			<div class="slider-container">
				<p class="slider-label">LOW-PASS FILTER FREQUENCY</p>
				<input type="range" class="slider" min="40" max="4000" value="1634" id="slider1" oninput="changeVoiceFilterFrequency()">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on1" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off1" style="visibility: hidden">
				<button class="onButton" id="onButton1" onclick="turnOffButton1()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_2.png" class="slider-digit-one" id="sliderFirstDigit1">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_3.png" class="slider-digit-two" id="sliderSecondDigit1">
				<p id="display1"></p>
			</div>
			<div class="slider-container">
				<p class="slider-label">HIGH-PASS FILTER FREQUENCY</p>
				<input type="range" class="slider" min="40" max="10000" value="1634" id="slider4" oninput="changeVoiceFilterFrequency()">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on2" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off2" style="visibility: hidden">
				<button class="onButton" id="onButton2" onclick="turnOffButton2()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit2">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit2">
				<p id="display8"></p>
			</div>
			<div class="slider-container">
				<p class="slider-label">VOICE GAIN</p>
				<input type="range" class="slider" min="0" max="40" value="13" id="gainSlider" oninput="changeVoiceGain()">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on3" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off3" style="visibility: hidden">
				<button class="onButton" id="onButton3" onclick="turnOffButton3()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit3">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit3">
				<p id="gainDisplay"></p>
			</div>
			<span class="slider-container">
				<p class="slider-label">RECEPTION</p>          
				<input type="range" min="0" max="99" value="10" id="crossFadeSlider" oninput="crossFadeUpdate()"><span id="crossFadeDisplay"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on4" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off4" style="visibility: hidden">
				<button class="onButton" id="onButton4" onclick="turnOffButton4()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit4">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit4">
			</span>
		
			<span class="slider-container">
				<p class="slider-label">VOICE VOLUME</p>
				<input type="range" min="0" max="99" value="51" id="voiceVolumeSlider" oninput="changeSourceVolumes()"><span id="voiceVolumeDisplay"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on5" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off5" style="visibility: hidden">
				<button class="onButton" id="onButton5" onclick="turnOffButton5()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit5">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit5">
			</span><br>
			<span class="slider-container">
				<p class="slider-label">HELICOPTER BLADES</p>
				<input type="range" min="0" max="99" value="42" id="volumeSlider0" oninput="changeSourceVolumes()"><span id="sourceDisplay0"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on6" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off6" style="visibility: hidden">
				<button class="onButton" id="onButton6" onclick="turnOffButton6()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit6">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit6">
			</span>
			<span class="slider-container">
				<p class="slider-label">HELICOPTER CABIN</p>
				<input type="range" min="0" max="99" value="13" id="volumeSlider1" oninput="changeSourceVolumes()"><span id="sourceDisplay1"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on7" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off7" style="visibility: hidden">
				<button class="onButton" id="onButton7" onclick="turnOffButton7()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit7">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit7">
			</span><br>
			<span class="slider-container">
				<p class="slider-label">STATIC VOLUME</p>
				<input type="range" min="0" max="99" value="53" id="volumeSlider2" oninput="changeSourceVolumes()"><span id="sourceDisplay2"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on8" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off8" style="visibility: hidden">
				<button class="onButton" id="onButton8" onclick="turnOffButton8()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit8">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit8">
			</span>
			<span class="slider-container">
				<p class="slider-label">RADIO BUTTON CLICK</p>
				<input type="range" min="0" max="99" value="63" id="volumeSlider3" oninput="changeSourceVolumes()"><span id="sourceDisplay3"></span>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-on" id="on9" style="visibility: visible">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/slider_on_light.png" class="light-off" id="off9" style="visibility: hidden">
				<button class="onButton" id="onButton9" onclick="turnOffButton9()"></button>
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-one" id="sliderFirstDigit9">
				<img src="https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/number_0.png" class="slider-digit-two" id="sliderSecondDigit9">
			</span>
			<span>
				<div class="button-container">
					<button class="play" onclick="playSound()">PLAY</button>
					<button class="stop" onclick="stopSound()">STOP</button>
					<button class="stop" onclick="resetSound()">RESET</button>
					<button id="downloadButton" onclick="downloadFile()">DOWNLOAD</button>
				</div>
			</span>

		</div>

		<div class="progress-bar" style="--width: 0; display: none" data-label="Processing..."></div>
	</div>
	 

	<script>
		var sources = [];
		var sourceGains = [];
		var volumeSliders = [];
		var sourceSliderDisplays = [];
		var files = ["https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/helicopter.wav",
		 			 "https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/helicopter2.wav", 
		  			 "https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/radio_static.wav", 
		 			 "https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/radio_click_on.mp3" ];
		var clickOnFile = "https://morning-beach-02656.herokuapp.com/https://brass-pineapple-jm4h.squarespace.com/s/click_on.mp3";
		var clickSource;
		var clickGain;
		var fileInput = document.getElementById("file1");
		var textArea = document.getElementById("fileTextArea");
		var voiceBuffer;
		var fileLength = 0;
		var downloadInterval;
		var crossFade;

		var context;
		var source;
		var audioBuffer;
		const SOURCE_COUNT = 4;
		var sourceAdded = false;

		var bufferSize;
		
		var filter1;
		var filter2;
		var filter1Gain;
		var filter1Volume;
		var filter1VolumeInit;
		var receptionVolumeInit;
		var master;

		var chunks;
		var mediaRecorder;
		var dest;
		var downloading;

		var slider = document.getElementById("slider1");
		var gainSlider = document.getElementById("gainSlider");
	  	var voiceVolumeSlider = document.getElementById("voiceVolumeSlider");
	  	var slider4 = document.getElementById("slider4");
	  	var slider9 = document.getElementById("slider9");
	  	var slider10 = document.getElementById("slider10");
	  	var crossFadeSlider = document.getElementById("crossFadeSlider");
	  	
		// var display1 = document.getElementById("display1");
		// display1.innerHTML = slider.value;

		// var gainDisplay = document.getElementById("gainDisplay");
		// gainDisplay.innerHTML = gainSlider.value;

		// var voiceVolumeDisplay = document.getElementById("voiceVolumeDisplay");
		// voiceVolumeDisplay.innerHTML = voiceVolumeSlider.value;

		// var display8 = document.getElementById("display8");
		// display8.innerHTML = slider4.value;

		// var crossFadeDisplay = document.getElementById("crossFadeDisplay");
		// crossFadeDisplay.innerHTML = crossFadeSlider.value;
		crossFade = crossFadeSlider.value / 100;

		const progressBar = document.getElementsByClassName("progress-bar")[0];
		// setInterval(() => {
		// 	const computedStyle = getComputedStyle(progressBar);
		// 	const width = parseFloat(computedStyle.getPropertyValue('--width')) || 0;
		// 	progressBar.style.setProperty('--width', width + .1);
		// }, 5);
		
		var on1 = document.getElementById("on1");
		var off1 = document.getElementById("off1");
		var isOnSlider1 = true;

		var on2 = document.getElementById("on2");
		var off2 = document.getElementById("off2");
		var isOnSlider2 = true;

		var on3 = document.getElementById("on3");
		var off3 = document.getElementById("off3");
		var isOnSlider3 = true;

		var on4 = document.getElementById("on4");
		var off4 = document.getElementById("off4");
		var isOnSlider4 = true;

		var on5 = document.getElementById("on5");
		var off5 = document.getElementById("off5");
		var isOnSlider5 = true;

		var on6 = document.getElementById("on6");
		var off6 = document.getElementById("off6");
		var isOnSlider6 = true;

		var on7 = document.getElementById("on7");
		var off7 = document.getElementById("off7");
		var isOnSlider7 = true;

		var on8 = document.getElementById("on8");
		var off8 = document.getElementById("off8");
		var isOnSlider8 = true;

		var on9 = document.getElementById("on9");
		var off9 = document.getElementById("off9");
		var isOnSlider9 = true;

		var firstDigit = imgNumber0;
		var secondDigit = imgNumber0;

		var imgNumber0 = document.getElementById("num0");
		var imgNumber1 = document.getElementById("num1");
		var imgNumber2 = document.getElementById("num2");
		var imgNumber3 = document.getElementById("num3");
		var imgNumber4 = document.getElementById("num4");
		var imgNumber5 = document.getElementById("num5");
		var imgNumber6 = document.getElementById("num6");
		var imgNumber7 = document.getElementById("num7");
		var imgNumber8 = document.getElementById("num8");
		var imgNumber9 = document.getElementById("num9");

		function displayDigitSlider1(){
			convertToImage(((slider1.value / 4000) * 100) - 1);
			document.getElementById("sliderFirstDigit1").src = firstDigit.src;
			document.getElementById("sliderSecondDigit1").src = secondDigit.src;
		}

		function displayDigitSlider2(){
			convertToImage(((slider4.value / 10000) * 100) - 1);
			document.getElementById("sliderFirstDigit2").src = firstDigit.src;
			document.getElementById("sliderSecondDigit2").src = secondDigit.src;
		}

		function displayDigitSlider3(){
			convertToImage(((gainSlider.value / 40) * 100) - 1);
			document.getElementById("sliderFirstDigit3").src = firstDigit.src;
			document.getElementById("sliderSecondDigit3").src = secondDigit.src;
		}

		function displayDigitSlider4(){
			convertToImage(crossFadeSlider.value);
			document.getElementById("sliderFirstDigit4").src = firstDigit.src;
			document.getElementById("sliderSecondDigit4").src = secondDigit.src;
		}

		function displayDigitSlider5(){
			convertToImage(voiceVolumeSlider.value);
			document.getElementById("sliderFirstDigit5").src = firstDigit.src;
			document.getElementById("sliderSecondDigit5").src = secondDigit.src;
		}

		function displayDigitSlider6(){
			convertToImage(volumeSlider0.value);
			document.getElementById("sliderFirstDigit6").src = firstDigit.src;
			document.getElementById("sliderSecondDigit6").src = secondDigit.src;
		}

		function displayDigitSlider7(){
			convertToImage(volumeSlider1.value);
			document.getElementById("sliderFirstDigit7").src = firstDigit.src;
			document.getElementById("sliderSecondDigit7").src = secondDigit.src;
		}
		function displayDigitSlider8(){
			convertToImage(volumeSlider2.value);
			document.getElementById("sliderFirstDigit8").src = firstDigit.src;
			document.getElementById("sliderSecondDigit8").src = secondDigit.src;
		}
		function displayDigitSlider9(){
			convertToImage(volumeSlider3.value);
			document.getElementById("sliderFirstDigit9").src = firstDigit.src;
			document.getElementById("sliderSecondDigit9").src = secondDigit.src;
		}

		function convertToImage(n){
			if (n < 0){
				n = 0;
			}
			n = Math.floor(n);
			switch (n % 10){
				case 0:
					firstDigit = imgNumber0;
					break;
				case 1:
					firstDigit = imgNumber1;
					break;
				case 2:
					firstDigit = imgNumber2;
					break;
				case 3:
					firstDigit = imgNumber3;
					break;
				case 4:
					firstDigit = imgNumber4;
					break;
				case 5:
					firstDigit = imgNumber5;
					break;
				case 6:
					firstDigit = imgNumber6;
					break;
				case 7:
					firstDigit = imgNumber7;
					break;
				case 8:
					firstDigit = imgNumber8;
					break;
				case 9:
					firstDigit = imgNumber9;
					break;
				default:
			}
			switch (Math.floor(n/10)){
				case 0:
					secondDigit = imgNumber0;
					break;
				case 1:
					secondDigit = imgNumber1;
					break;
				case 2:
					secondDigit = imgNumber2;
					break;
				case 3:
					secondDigit = imgNumber3;
					break;
				case 4:
					secondDigit = imgNumber4;
					break;
				case 5:
					secondDigit = imgNumber5;
					break;
				case 6:
					secondDigit = imgNumber6;
					break;
				case 7:
					secondDigit = imgNumber7;
					break;
				case 8:
					secondDigit = imgNumber8;
					break;
				case 9:
					secondDigit = imgNumber9;
					break;
				default:
				
			}
		}

		function turnOffButton1(){
			if (on1.style.visibility == 'hidden')
			{
				on1.style.visibility ='visible';
				off1.style.visibility = 'hidden';
				isOnSlider1 = true;
				filter1.type = "lowpass";				
			}
			else
			{
				on1.style.visibility ='hidden';
				off1.style.visibility = 'visible';
				isOnSlider1 = false;
				filter1.type = "allpass";			
			}
		}

		function turnOffButton2(){
			if (on2.style.visibility == 'hidden')
			{
				on2.style.visibility ='visible';
				off2.style.visibility = 'hidden';
				isOnSlider2 = true;
				filter2.type = "highpass";
			}
			else
			{
				on2.style.visibility ='hidden';
				off2.style.visibility = 'visible';
				isOnSlider2 = false;
				filter2.type = "allpass";
			}

		}

		function turnOffButton3(){
			if (on3.style.visibility == 'hidden')
			{
				on3.style.visibility ='visible';
				off3.style.visibility = 'hidden';
				isOnSlider3 = true;
				filter1Gain.gain.value = gainSlider.value;
			}
			else
			{
				on3.style.visibility ='hidden';
				off3.style.visibility = 'visible';
				isOnSlider3 = false;
				filter1Gain.gain.value = 1.0;
			}
		}

		function turnOffButton4(){
			if (on4.style.visibility == 'hidden')
			{
				on4.style.visibility ='visible';
				off4.style.visibility = 'hidden';
				isOnSlider4 = true;
				crossFade = 0;
				crossFadeUpdate();
			}
			else
			{
				on4.style.visibility ='hidden';
				off4.style.visibility = 'visible';
				isOnSlider4 = false;
				crossFade = 1.0;
				crossFadeUpdate();
			}
		}

		function turnOffButton5(){
			if (on5.style.visibility == 'hidden')
			{
				on5.style.visibility ='visible';
				off5.style.visibility = 'hidden';
				isOnSlider5 = true;
				changeSourceVolumes();
			}
			else
			{
				on5.style.visibility ='hidden';
				off5.style.visibility = 'visible';
				isOnSlider5 = false;
				changeSourceVolumes();
			}
		}

		function turnOffButton6(){
			if (on6.style.visibility == 'hidden')
			{
				on6.style.visibility ='visible';
				off6.style.visibility = 'hidden';
				isOnSlider6 = true;
				sourceGains[0].gain.value = volumeSliders[0].value / 100;
				changeSourceVolumes();
			}
			else
			{
				on6.style.visibility ='hidden';
				off6.style.visibility = 'visible';
				isOnSlider6 = false;
				sourceGains[0].gain.value = 0;
				changeSourceVolumes();
			}
		}

		function turnOffButton7(){
			if (on7.style.visibility == 'hidden')
			{
				on7.style.visibility ='visible';
				off7.style.visibility = 'hidden';
				isOnSlider7 = true;
				sourceGains[1].gain.value = volumeSliders[1].value / 100;
				changeSourceVolumes();
			}
			else
			{
				on7.style.visibility ='hidden';
				off7.style.visibility = 'visible';
				isOnSlider7 = false;
				sourceGains[1].gain.value = 0;
				changeSourceVolumes();
			}
		}

		function turnOffButton8(){
			if (on8.style.visibility == 'hidden')
			{
				on8.style.visibility ='visible';
				off8.style.visibility = 'hidden';
				isOnSlider8 = true;
				sourceGains[2].gain.value = volumeSliders[2].value / 100;
				changeSourceVolumes();
			}
			else
			{
				on8.style.visibility ='hidden';
				off8.style.visibility = 'visible';
				isOnSlider8 = false;
				sourceGains[2].gain.value = 0;
				changeSourceVolumes();
			}
		}

		function turnOffButton9(){
			if (on9.style.visibility == 'hidden')
			{
				on9.style.visibility ='visible';
				off9.style.visibility = 'hidden';
				isOnSlider9 = true;
				sourceGains[3].gain.value = volumeSliders[3].value / 100;
				changeSourceVolumes();
			}
			else
			{
				on9.style.visibility ='hidden';
				off9.style.visibility = 'visible';
				isOnSlider9 = false;
				sourceGains[3].gain.value = 0;
				changeSourceVolumes();
			}
		}

		

		function initializeData(){
			context = new (window.AudioContext || window.webkitAudioContext);
			master = context.createGain();
			master.gain.value = 1.0;
			master.connect(context.destination);
			displayDigitSlider2();
			displayDigitSlider3();
			displayDigitSlider4();
			displayDigitSlider5();
			displayDigitSlider6();
			displayDigitSlider7();
			displayDigitSlider8();
			displayDigitSlider9();
			sources[0] = context.createMediaElementSource(document.getElementById("audio1"));
			sources[1] = context.createMediaElementSource(document.getElementById("audio2"));
			sources[2] = context.createMediaElementSource(document.getElementById("audio3"));
			sources[3] = context.createMediaElementSource(document.getElementById("audio4"));
			//sources[0].crossOrigin = "anonymous";



			volumeSliders[0] = document.getElementById("volumeSlider0");
			volumeSliders[1] = document.getElementById("volumeSlider1");
			volumeSliders[2] = document.getElementById("volumeSlider2");
			volumeSliders[3] = document.getElementById("volumeSlider3");
			sourceGains[0] = context.createGain();
			sourceGains[1] = context.createGain();
			sourceGains[2] = context.createGain();
			sourceGains[3] = context.createGain();
			sourceSliderDisplays[0] = document.getElementById("sourceDisplay0");
			sourceSliderDisplays[1] = document.getElementById("sourceDisplay1");
			sourceSliderDisplays[2] = document.getElementById("sourceDisplay2");
			sourceSliderDisplays[3] = document.getElementById("sourceDisplay3");
			sources[0].connect(sourceGains[0]);
			sources[1].connect(sourceGains[1]);
			sources[2].connect(sourceGains[2]);
			sources[3].connect(sourceGains[3]);
			sourceGains[0].connect(master);
			sourceGains[1].connect(master);
			sourceGains[2].connect(master);
			sourceGains[3].connect(master);
			source = context.createMediaElementSource(document.getElementById("voiceAudio"));
			initFilters();
			connectVoiceChain();
			// master = context.createGain();
			// master.gain.value = 1;
			// master.connect(context.destination);
			// //loadFile("file_2.wav", 0);
			// loadSources(function(){
			// 	initFilters();
				
			// 	console.log("loading sliders");
			// 	for (var i=0; i<SOURCE_COUNT; i++){
			// 		volumeSliders[i] = document.getElementById("volumeSlider" + i);
			// 		sourceGains[i] = context.createGain();
			// 		sourceGains[i].gain.value = volumeSliders[i].value / 100;
			// 		sourceSliderDisplays[i] = document.getElementById("sourceDisplay" + i);
			// 		console.log(sourceGains[i]);
			// 		sourceSliderDisplays[i].innerHTML = volumeSliders[i].value;
					
					
			
			// 	}
			// 	//connectSourcesToGains();
			// });
			
			
			
		}

		// function loadSources(callback){
		// 	for (var i=0; i<SOURCE_COUNT; i++){
		// 		loadFile(files[i], i);
		// 	}
		// 	loadFile2(clickOnFile, clickSource, clickGain);
		// 	callback();
		// }

		function loadSources(callback){

			// sources[0] = context.createMediaElementSource(document.getElementById("audio1"));
			// sources[1] = context.createMediaElementSource(document.getElementById("audio2"));
			// sources[2] = context.createMediaElementSource(document.getElementById("audio3"));
			// sources[3] = context.createMediaElementSource(document.getElementById("audio4"));
			// volumeSliders[0] = document.getElementById("volumeSlider0");
			// volumeSliders[1] = document.getElementById("volumeSlider1");
			// volumeSliders[2] = document.getElementById("volumeSlider2");
			// volumeSliders[3] = document.getElementById("volumeSlider3");
			// sourceGains[0] = context.createGain();
			// sourceGains[1] = context.createGain();
			// sourceGains[2] = context.createGain();
			// sourceGains[3] = context.createGain();
			// sourceSliderDisplays[0] = document.getElementById("sourceDisplay0");
			// sourceSliderDisplays[1] = document.getElementById("sourceDisplay1");
			// sourceSliderDisplays[2] = document.getElementById("sourceDisplay2");
			// sourceSliderDisplays[3] = document.getElementById("sourceDisplay3");
			// sources[0].connect(sourceGains[0]);
			// sources[1].connect(sourceGains[1]);
			// sources[2].connect(sourceGains[2]);
			// sources[3].connect(sourceGains[3]);
			// sourceGains[0].connect(master);
			// sourceGains[1].connect(master);
			// sourceGains[2].connect(master);
			// sourceGains[3].connect(master);
			
			//audioBuffer = buffer;
		    	
		    	//initVoiceSource(src);
		    	//sources[sourceIndex] = context.createBufferSource();
		    	//sources[sourceIndex].buffer = audioBuffer;
		    	//volumeSliders[sourceIndex] = document.getElementById("volumeSlider" + sourceIndex);
				//sourceGains[sourceIndex] = context.createGain();
				if (isOnSlider6){				
					sourceGains[0].gain.value = volumeSliders[0].value / 100;
				}
				else {
					sourceGains[0].gain.value = 0;
				}
				if (isOnSlider7){				
					sourceGains[1].gain.value = volumeSliders[1].value / 100;
				}
				else {
					sourceGains[1].gain.value = 0;
				}
				if (isOnSlider8){				
					sourceGains[2].gain.value = volumeSliders[2].value / 100;
				}
				else {
					sourceGains[2].gain.value = 0;
				}
				if (isOnSlider9){				
					sourceGains[3].gain.value = volumeSliders[3].value / 100;
				}
				else {
					sourceGains[3].gain.value = 0;
				}
				//sourceGains[sourceIndex].gain.value = volumeSliders[sourceIndex].value / 100;
				//sourceSliderDisplays[sourceIndex] = document.getElementById("sourceDisplay" + sourceIndex);
				//sourceSliderDisplays[sourceIndex].innerHTML = volumeSliders[sourceIndex].value;
		    	//connectSourcesToGains(sourceIndex);
		    	
		    		//sources[sourceIndex].start();
		    	document.getElementById("audio1").play();
		    	document.getElementById("audio2").play();
		    	document.getElementById("audio3").play();
		    	document.getElementById("audio4").play();
		 //    sources[0].start();
			// sources[1].start();
			// sources[2].start();
			// sources[3].start();
		    	
		}

		function stopSound() {
			document.getElementById("audio1").pause();
			
			document.getElementById("audio2").pause();
			
			document.getElementById("audio3").pause();
			
			document.getElementById("audio4").pause();
			
			document.getElementById("voiceAudio").pause();
			
			
	  		// if (context.state != 'closed'){
		  	// 	context.close().then(function(){
		  	// 		source = null;
		  	// 	});
	  		// }
	  		if (mediaRecorder){
	  			if (mediaRecorder.state != 'inactive')
	  			{
	  				mediaRecorder.stop();
	  			}
	  		}
		}

		function resetSound(){
			document.getElementById("audio1").pause();
			document.getElementById("audio1").currentTime = 0;
			document.getElementById("audio2").pause();
			document.getElementById("audio2").currentTime = 0;
			document.getElementById("audio3").pause();
			document.getElementById("audio3").currentTime = 0;
			document.getElementById("audio4").pause();
			document.getElementById("audio4").currentTime = 0;
			document.getElementById("voiceAudio").pause();
			document.getElementById("voiceAudio").currentTime = 0;
		}



		function changeSourceVolumes()
		{
			
			for (var i=0; i<SOURCE_COUNT; i++){
				if (sourceGains[i])
					sourceGains[i].gain.value = volumeSliders[i].value / 100;
				//sourceSliderDisplays[i].innerHTML = volumeSliders[i].value;
			}
			if (isOnSlider5){				
				filter1VolumeInit = voiceVolumeSlider.value / 100;
			}
			else {
				filter1VolumeInit = 0;
			}
			if (isOnSlider6){	
				if (sourceGains[0])			
					sourceGains[0].gain.value = volumeSliders[0].value / 100;
			}
			else {
				if (sourceGains[0])							
					sourceGains[0].gain.value = 0;
			}
			if (isOnSlider7){	
				if (sourceGains[1])			
					sourceGains[1].gain.value = volumeSliders[1].value / 100;
			}
			else {
				if (sourceGains[1])
					sourceGains[1].gain.value = 0;
			}
			if (isOnSlider8){	
				if (sourceGains[2])			
					sourceGains[2].gain.value = volumeSliders[2].value / 100;
			}
			else {
				if (sourceGains[2])
					sourceGains[2].gain.value = 0;
			}
			if (isOnSlider9){
				if (sourceGains[3])				
					sourceGains[3].gain.value = volumeSliders[3].value / 100;
			}
			else {
				if (sourceGains[3])
					sourceGains[3].gain.value = 0;
			}
			//voiceVolumeDisplay.innerHTML = voiceVolumeSlider.value;
			if (volumeSliders[2])
				receptionVolumeInit = volumeSliders[2].value / 50;
			
			applyCrossFade();
			
			displayDigitSlider5();
			displayDigitSlider6()
			displayDigitSlider7()
			displayDigitSlider8()
			displayDigitSlider9()
		}

		function changeVoiceFilterFrequency()
		{
			displayDigitSlider1();
			displayDigitSlider2();
			if (filter1)
				filter1.frequency.value = slider.value;
			//display1.innerHTML = slider.value;
			if (filter2)
				filter2.frequency.value = slider4.value;
			//display8.innerHTML = slider4.value;
			
		}

		function changeVoiceGain(){
			if (isOnSlider3){
				if (filter1Gain)
					filter1Gain.gain.value = gainSlider.value;
			}
			else{
				if (filter1Gain)
					filter1Gain.gain.value = 1.0;
			}
			//gainDisplay.innerHTML = gainSlider.value;
			displayDigitSlider3()
		}

		function initFilters(){
			filter1 = context.createBiquadFilter();
			if (isOnSlider1){
				filter1.type = 'lowpass';
			}
			else{
				filter1.type = 'allpass';
			}
		  	filter1.frequency.value = slider.value;

		  	filter2 = context.createBiquadFilter();
		  	if (isOnSlider2){
				filter2.type = 'highpass';
			}
			else{
				filter2.type = 'allpass';
			}
		  	//filter2.type = 'highpass';
		  	filter2.frequency.value = slider4.value;
		  	
		  	filter1Gain = context.createGain();
		  	if (isOnSlider3){
				filter1Gain.gain.value = gainSlider.value;
			}
			else{
				filter1Gain.gain.value = 1.0;
			}
		  	
		  	filter1Volume = context.createGain();
		  	//filter1Volume.gain.value = 0;
		  	if (isOnSlider5){				
				filter1VolumeInit = voiceVolumeSlider.value / 100;
			}
			else {
				filter1Volume.gain.value = 0;
			}
		  	//filter1VolumeInit = voiceVolumeSlider.value / 100;

		}

		// function playHelicopterSounds(){
		// 	for (var i=0; i<SOURCE_COUNT; i++){
		// 		sources[i].start();
				
		// 	}
		// }

		function connectSourcesToGains(index){
			sources[index].connect(sourceGains[index]);
			sourceGains[index].connect(master);
			
		}

		// function initVoiceSource(src){
		// 	src = context.createBufferSource();
		//   	src.buffer = audioBuffer;
		//   	src.loop = false;
		//   	src.onended = function(){
		//   		stopSound();
		//   	}
		// }

		function crossFadeUpdate(){
			if (isOnSlider4){
				crossFade = crossFadeSlider.value / 100;
			}
			else{
				crossFade = 0;
			}
			//crossFadeDisplay.innerHTML = crossFadeSlider.value;
			displayDigitSlider4()
			changeSourceVolumes();
			//applyCrossFade();
		}

		function applyCrossFade(){
			if (filter1)
				filter1Volume.gain.value = filter1VolumeInit * (1 - crossFade);
			if (sourceGains[2])
				sourceGains[2].gain.value = receptionVolumeInit * crossFade;			
		}

		function playSound() {
			context.resume().then(() => {
			// if (voiceBuffer)
			// {
				if (context){
					if (context.state == 'closed'){
					  	context = new (window.AudioContext || window.webkitAudioContext);
					}
				}
				// master = context.createGain();
				// master.gain.value = 1.0;
				// master.connect(context.destination);
				loadSources(function(){		// this already creates gains and volume sliders 
					//initFilters();
					// for (var i=0; i<SOURCE_COUNT; i++){
					// 	volumeSliders[i] = document.getElementById("volumeSlider" + i);
					// 	sourceGains[i] = context.createGain();
						
					// 	//sourceGains[i].gain.value = volumeSliders[i].value / 100;
					// 	//sourceSliderDisplays[i] = document.getElementById("sourceDisplay" + i);
					// 	//sourceSliderDisplays[i].innerHTML = volumeSliders[i].value;
					// 	//playHelicopterSounds();
					// }
					// if (isOnSlider6){				
					// 	sourceGains[0].gain.value = volumeSliders[0].value / 100;
					// }
					// else {
					// 	sourceGains[0].gain.value = 0;
					// }
					// if (isOnSlider7){				
					// 	sourceGains[1].gain.value = volumeSliders[1].value / 100;
					// }
					// else {
					// 	sourceGains[1].gain.value = 0;
					// }
					// if (isOnSlider8){				
					// 	sourceGains[2].gain.value = volumeSliders[2].value / 100;
					// }
					// else {
					// 	sourceGains[2].gain.value = 0;
					// }
					// if (isOnSlider9){				
					// 	sourceGains[3].gain.value = volumeSliders[3].value / 100;
					// }
					// else {
					// 	sourceGains[3].gain.value = 0;
					// }
				});
				//initVoiceSource(audioBuffer);


			  	

				//reinitializeVoiceSource();
				
		  		if (source){
		  			//applyCrossFade();
		  			//source.start();
		  			document.getElementById("voiceAudio").play();
		  		}
		  	//}

		  	//connectAudioNodes();
		  	// if (source){
		  	// 	source.start(); // Play immediately.
		  	// }
		  	// else{
		  	// 	console.log("reinitializing voice source");
		  	// 	reinitializeVoiceSource();
		  	// 	if (source){
		  	// 		source.start();
		  	// 	}
		  	// }
		 //  	dest = context.createMediaStreamDestination();
			// mediaRecorder = new MediaRecorder(dest.stream);
			// downloading = false;
		  	});
		  	
		}

		function connectVoiceChain(){
			source.connect(filter1);
		  	filter1.connect(filter2);
		  	filter2.connect(filter1Gain);
		  	filter1Gain.connect(filter1Volume);
		  	filter1Volume.connect(master);
		}

		function initSound(arrayBuffer, sourceIndex) {
			
		  	context.decodeAudioData(arrayBuffer, function(buffer) {
		    	// audioBuffer is global to reuse the decoded audio later.
		    	audioBuffer = buffer;
		    	
		    	//initVoiceSource(src);
		    	sources[sourceIndex] = context.createBufferSource();
		    	sources[sourceIndex].buffer = audioBuffer;
		    	volumeSliders[sourceIndex] = document.getElementById("volumeSlider" + sourceIndex);
				sourceGains[sourceIndex] = context.createGain();
				if (isOnSlider6){				
					sourceGains[0].gain.value = volumeSliders[0].value / 100;
				}
				else {
					sourceGains[0].gain.value = 0;
				}
				if (isOnSlider7){				
					sourceGains[1].gain.value = volumeSliders[1].value / 100;
				}
				else {
					sourceGains[1].gain.value = 0;
				}
				if (isOnSlider8){				
					sourceGains[2].gain.value = volumeSliders[2].value / 100;
				}
				else {
					sourceGains[2].gain.value = 0;
				}
				if (isOnSlider9){				
					sourceGains[3].gain.value = volumeSliders[3].value / 100;
				}
				else {
					sourceGains[3].gain.value = 0;
				}
				//sourceGains[sourceIndex].gain.value = volumeSliders[sourceIndex].value / 100;
				sourceSliderDisplays[sourceIndex] = document.getElementById("sourceDisplay" + sourceIndex);
				//sourceSliderDisplays[sourceIndex].innerHTML = volumeSliders[sourceIndex].value;
		    	connectSourcesToGains(sourceIndex);
		    	
		    		sources[sourceIndex].start();
		    	
		    	
		    	var buttons = document.querySelectorAll('button');
		    	buttons[0].disabled = false;
		    	buttons[1].disabled = false;
		  	}, function(e) {
		    	console.log('Error decoding file', e);
		  	}); 
		}

		function initSound2(arrayBuffer, src, gn) {
			
		  	context.decodeAudioData(arrayBuffer, function(buffer) {
		    	// audioBuffer is global to reuse the decoded audio later.
		    	audioBuffer = buffer;
		    	
		    	//initVoiceSource(src);
		    	src = context.createBufferSource();
		    	src.buffer = audioBuffer;
		    	
				gn = context.createGain();
				if (isOnSlider6){				
					sourceGains[0].gain.value = volumeSliders[0].value / 100;
				}
				else {
					sourceGains[0].gain.value = 0;
				}
				if (isOnSlider7){				
					sourceGains[1].gain.value = volumeSliders[1].value / 100;
				}
				else {
					sourceGains[1].gain.value = 0;
				}
				if (isOnSlider8){				
					sourceGains[2].gain.value = volumeSliders[2].value / 100;
				}
				else {
					sourceGains[2].gain.value = 0;
				}
				if (isOnSlider9){				
					sourceGains[3].gain.value = volumeSliders[3].value / 100;
				}
				else {
					sourceGains[3].gain.value = 0;
				}
				//gn.gain.value = volumeSliders[3].value / 50;
				src.connect(gn);
				gn.connect(master);
		    	
		    	src.start();
		    	
		    	var buttons = document.querySelectorAll('button');
		    	buttons[0].disabled = false;
		    	buttons[1].disabled = false;
		  	}, function(e) {
		    	console.log('Error decoding file', e);
		  	}); 
		}

		function initVoiceSource(arrayBuffer){
			if (context.state == 'closed'){
				context = new (window.AudioContext || window.webkitAudioContext);
			}
			// if (!master)
			// {
			
			master = context.createGain();
			master.gain.value = 1.0;
			master.connect(context.destination);
			// }
			context.decodeAudioData(arrayBuffer, function(buffer) {
		    	// audioBuffer is global to reuse the decoded audio later.
		    	audioBuffer = buffer;
		    	voiceBuffer = audioBuffer;
		    	//initVoiceSource(src);
		    	source = context.createBufferSource();
		    	source.onended = function(){
		    		console.log("sound ended");
			  		stopSound();
			  	}
		    	source.buffer = voiceBuffer;
		    	
				sourceGain = context.createGain();
				sourceGain.gain.value = gainSlider.value;
				//gainDisplay.innerHTML = gainSlider.value;

				initFilters();
				
				
		    	connectVoiceChain();
		    	
		    	var buttons = document.querySelectorAll('button');
		    	buttons[0].disabled = false;
		    	buttons[1].disabled = false;
		    	sourceAdded = true;
		  	}, function(e) {
		    	console.log('Error decoding file', e);
		  	});
		}

		function reinitializeVoiceSource(){
			source = context.createBufferSource();
	    	source.buffer = voiceBuffer;
	    	source.onended = function(){
	    		
		  		stopSound();
		  	}
			sourceGain = context.createGain();
			sourceGain.gain.value = gainSlider.value;
			//gainDisplay.innerHTML = gainSlider.value;

			initFilters();
			
			
	    	connectVoiceChain();
	    	
		}

		

		// User selects file, read it as an ArrayBuffer and pass to the API.
		
		

		fileInput.addEventListener('change', function(e) {  
			document.getElementById("voiceAudio").src = this.files[0].name;
		  	var reader = new FileReader();
		  	reader.onload = function(e) {
		    	//initVoiceSource(this.result);
		    	//var myArrayBuffer = context.createBuffer(2)
		    	//voiceBuffer = this.result;
		    	console.log(this.result);
		    	context.decodeAudioData(this.result, function(buffer) {
			    	// audioBuffer is global to reuse the decoded audio later.
			    	audioBuffer = buffer;
			    	voiceBuffer = audioBuffer;
			    	console.log(voiceBuffer.duration);
			    	//initVoiceSource(src);
			    	sourceAdded = true;
			  	}, function(e) {
			    	console.log('Error decoding file', e);
			  	});
		    	// initVoiceSource(voiceBuffer);

		    	
		  	};
		  	textArea.value = this.files[0].name;
		  	reader.readAsArrayBuffer(this.files[0]);
		}, false);

		function downloadFile(){
			if (context){
				if (context.state == 'closed'){
				  	context = new (window.AudioContext || window.webkitAudioContext);
				}
			}
			var recorderDest = context.createMediaStreamDestination();
			// master = context.createGain();
			// master.gain.value = 1.0;
			master.connect(recorderDest);
			chunks = [];
			
			loadSources(function(){
			// 	//initFilters();
			// 	for (var i=0; i<SOURCE_COUNT; i++){
			// 		volumeSliders[i] = document.getElementById("volumeSlider" + i);
			// 		sourceGains[i] = context.createGain();

			// 		//sourceGains[i].gain.value = volumeSliders[i].value / 100;
			// 		sourceSliderDisplays[i] = document.getElementById("sourceDisplay" + i);
			// 		//sourceSliderDisplays[i].innerHTML = volumeSliders[i].value;
			// 		//playHelicopterSounds();
			// 	}
			// 	if (isOnSlider6){				
			// 		sourceGains[0].gain.value = volumeSliders[0].value / 100;
			// 	}
			// 	else {
			// 		sourceGains[0].gain.value = 0;
			// 	}
			// 	if (isOnSlider7){				
			// 		sourceGains[1].gain.value = volumeSliders[1].value / 100;
			// 	}
			// 	else {
			// 		sourceGains[1].gain.value = 0;
			// 	}
			// 	if (isOnSlider8){				
			// 		sourceGains[2].gain.value = volumeSliders[2].value / 100;
			// 	}
			// 	else {
			// 		sourceGains[2].gain.value = 0;
			// 	}
			// 	if (isOnSlider9){				
			// 		sourceGains[3].gain.value = volumeSliders[3].value / 100;
			// 	}
			// 	else {
			// 		sourceGains[3].gain.value = 0;
			// 	}
			});
			//initVoiceSource(audioBuffer);


		  	

			//reinitializeVoiceSource();
			
		  		if (source){
		  			document.getElementById("voiceAudio").play();
		  			// console.log("starting source");
		  			// source.start();
		  			// console.log("source length: " + voiceBuffer.duration);
		  		}
		  	progressBar.style.display = "";
			mediaRecorder = new MediaRecorder(recorderDest.stream);
			var downloadButton = document.getElementById("downloadButton");
			
			mediaRecorder.start();
			var i = 0;
			downloadInterval = setInterval (() => {
				const computedStyle = getComputedStyle(progressBar);
				const width = parseFloat(computedStyle.getPropertyValue('--width')) || 0;
				progressBar.style.setProperty('--width', width + (100/(voiceBuffer.duration*1000)) * 5);
			}, 5);
			//initVoiceSource();
			//initHelicopters();
			//connectAudioNodes();
			//filter1Volume.connect(dest);
			//source.start();
			downloading = true;

			mediaRecorder.ondataavailable = function(e){
				chunks.push(e.data);
				
			}

			mediaRecorder.onstop = function(e){
				var blob = new Blob(chunks, {'type' : 'audio/ogg; codecs=opus'});
				var url = URL.createObjectURL(blob);
				//document.querySelector("audio").src = url;
				var downloadLink;
				if (!document.getElementById("download"))
				{
					downloadLink = document.createElement('a');
					downloadLink.id = "download";
				}
				else{
					downloadLink = document.getElementById("download");
				}
				downloadLink.href = url;
				downloadLink.download = "file1" + ".oga";
				downloadLink.innerHTML = "Download";
				downloadLink.margin = 100;
				progressBar.appendChild(downloadLink);
				clearInterval(downloadInterval);
				progressBar.dataset.label = "Complete";
				downloadLink.click();
				downloadLink.remove();
				setTimeout(function(){
					progressBar.style.display = 'none';
				}, 200);
			}
		}
		
		

		// Load file from a URL as an ArrayBuffer.
		// Example: loading via xhr2: loadSoundFile('sounds/test.mp3');
		function loadFile(url, sourceIndex) {
		  	var xhr = new XMLHttpRequest();
		  	xhr.open('GET', url, true);
		  	xhr.responseType = 'arraybuffer';
		  	xhr.onload = function(e) {
		  		
		    	initSound(this.response, sourceIndex); // this.response is an ArrayBuffer.
		    	//connectSourcesToGains(sourceIndex);
		  	};
		  	xhr.send();
		}
		function loadFile2(url, src, gain) {
		  	var xhr = new XMLHttpRequest();
		  	xhr.open('GET', url, true);
		  	xhr.responseType = 'arraybuffer';
		  	xhr.onload = function(e) {
		  		
		    	initSound2(this.response, src, gain); // this.response is an ArrayBuffer.
		    	//connectSourcesToGains(sourceIndex);
		  	};
		  	xhr.send();
		}
</script>
	
</body>
</html>